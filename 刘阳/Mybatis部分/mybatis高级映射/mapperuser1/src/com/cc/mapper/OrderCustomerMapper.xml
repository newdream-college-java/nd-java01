<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cc.mapper.OrderCustomerMapper">
	<select id="orderfind" resultType="OrderCustomer">
	SELECT 
		  orders.*,
		  user.username,
		  user.sex 
		FROM
		  orders,
		  USER 
		WHERE orders.user_id = user.id and orders.id=#{orderId}
	</select>
	
	
	
	
	
	
	<resultMap type="Orders" id="orderMapUser">
		<result property="id" column="id"/>
		<result property="userId" column="user_id"/>
		<result property="createtime" column="createtime"/>
		<result property="note" column="note"/>
		
		<association property="user" javaType="User">
		<result property="username" column="username"/>
		<result property="sex" column="sex"/>
		</association>

	</resultMap>
	<select id="orderfind1" resultMap="orderMapUser">
	SELECT 
		  orders.*,
		  user.username,
		  user.sex 
		FROM
		  orders,
		  USER 
		WHERE orders.user_id = user.id and orders.id=#{orderId}
	</select>
	
	
	
	
	
	<resultMap type="Orders" id="orderMapDetail" extends="orderMapUser">
		<collection property="orderdetails" ofType="OrderDetail">
		<result property="id" column="orderdetail_id"/>
		<result property="itemsId" column="items_id"/>
		<result property="itemsNum" column="items_num"/>
		</collection>

	</resultMap>
	<select id="orderfind2" resultMap="orderMapDetail">
	SELECT 
          orders.*,
           orderdetail.id orderdetail_id,
		  orderdetail.items_num,
		  orderdetail.items_id
        FROM
          orders,
          orderdetail 
        WHERE orders.id = orderdetail.orders_id and orders.id=4
	</select>
	
	
	
	
	
	<resultMap type="User" id="orderMapItem" >
		<result property="username" column="username"/>
		<result property="sex" column="sex"/>
		<collection property="orders" ofType="Orders">
			<result property="userId" column="user_id"/>
			<result property="id" column="id"/>
			<result property="createtime" column="createtime"/>
			<result property="note" column="note"/>
			<result property="number" column="number"/>
				<collection property="orderdetails" ofType="Orderdetail">
					<result property="id" column="orderdetail_id"/>
					<result property="itemsId" column="items_id"/>
					<result property="itemsNum" column="items_num"/>
						<association property="items" javaType="Items">
							<result property="name" column="items_name"/>
							<result property="detail" column="items_detail"/>
						</association>
				</collection>
		</collection>
	
		
	</resultMap>
	
	<select id="findItem" resultMap="orderMapItem">
	SELECT 
	  orders.*,
	  user.username,
	  user.sex ,
	  orderdetail.id orderdetail_id,
	  orderdetail.items_num,
	  orderdetail.items_id,
	  items.name items_name,
	  items.detail items_detail
	FROM
	  orders,
	  USER,
	  orderdetail,
	  items
	WHERE orders.user_id = user.id  
	AND orders.id = orderdetail.orders_id 
	AND items.id = orderdetail.items_id	
	and user.id=#{userId}
	</select>
	
	
	<!-- 多对多 -->
	<resultMap type="User" id="UserItemsMap" >
		<result property="username" column="username"/>
		<result property="sex" column="sex"/>
		<collection property="items" ofType="Items">
			<result property="name" column="items_name"/>
			<result property="detail" column="items_detail"/>
				<collection property="user" ofType="User">
					<result property="username" column="username"/>
					<result property="sex" column="sex"/>
				</collection>
		</collection>
	</resultMap>
	
	<select id="querItemsByUserId" resultMap="UserItemsMap">
	SELECT 
	  orders.*,
	  user.username,
	  user.sex ,
	  items.name items_name,
	  items.detail items_detail
	FROM
	  orders,
	  USER,
	  orderdetail,
	  items
	WHERE orders.user_id = user.id  
	AND orders.id = orderdetail.orders_id 
	AND items.id = orderdetail.items_id	
	</select>
</mapper>